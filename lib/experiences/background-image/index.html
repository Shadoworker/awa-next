<!DOCTYPE html> 
<html> 

<head> 
	<style> 
		body
		{
			margin: 0px;
		}
		svg{
			border: solid 1px green;
		}
		.patterns { 
			background-color: #5a65748f; 
			/* margin: 1%;  */
			height: 100vh; 
		} 
	</style> 
</head> 

<body> 
	<!-- <h3 style="color:green;text-align: center;"> 
		SVG BG 
	</h3>  -->
	<div class="patterns"> 

		<svg width="600" height="350" xmlns="http://www.w3.org/2000/svg">
			<defs>
			 
				<!-- <pattern id="patt-1" x="0" y="0" width="1" height="1" patternUnits="userSpaceOnUse" patternContentUnits="" >
					<image id="patt-1-image" href="./bg-1.jpeg" x="0" y="0" width="1" height="1" preserveAspectRatio="none" />
				</pattern> -->

				<pattern id="patt-1" x="0" y="0" width="200" height="100" patternUnits="userSpaceOnUse" patternContentUnits="">
					<image id="patt-1-image" href="./bg-4.png" x="0" y="0" width="200" height="100" preserveAspectRatio="none" 
					  />
				</pattern>

				<rect id="def-rect-1" x="0" y="0" width="400" height="300" stroke="red" />

			</defs>
	 
			<g id="rect-1-elements">
				<use href="#def-rect-1" x="0" fill="url(#patt-1)" />
				<use href="#def-rect-1" x="0" fill="#ff000010" />
			</g>
			
		</svg>
		
 
		  <span>GRID : </span> <input id="gridSlider" value="0" type="range" oninput="gridSliderOnChange()" >
		  <span>H : </span> <input id="hSpacingSlider" value="0" type="range" oninput="hSpacingSliderOnChange()" >
		  <span>V : </span> <input id="vSpacingSlider" value="0" type="range" oninput="vSpacingSliderOnChange()" >
  
	</div>
	
	<script>

		function initBg(baseScale=-1)
		{

			var img = new Image();
			img.src = "./bg-4.png";
			img.onload = function() 
			{
				var realWidth = this.naturalWidth;
				var realHeight = this.naturalHeight;

				var rectWidth = 400;
				var rectHeight = 300;

				if(baseScale == -1) // Fit
				{
					var bgWRatio = rectWidth / realWidth, 
						bgHRatio = rectHeight / realHeight;

						// console.log(bgWRatio, bgHRatio)

					document.querySelector("#patt-1").setAttribute("width", realWidth)
					document.querySelector("#patt-1").setAttribute("height", realHeight)
 
					document.querySelector("#patt-1 image").setAttribute("width", realWidth)
					document.querySelector("#patt-1 image").setAttribute("height", realHeight)

					var newBgHeight = realHeight * bgWRatio;
					// console.log(newBgHeight)
					var translateY = (rectHeight - newBgHeight)/2;
					// console.log(rectHeight - newBgHeight)

					document.querySelector("#patt-1 image").setAttribute("transform", `scale(${bgWRatio}) translate(0, ${translateY})`)


				}
				else if(baseScale == 0) // Fill
				{

					var bgWRatio = rectWidth / realWidth, 
						bgHRatio = rectHeight / realHeight;

					var scaler = (realWidth>realHeight) ? bgHRatio : bgWRatio;
						// console.log(bgWRatio, bgHRatio)

					document.querySelector("#patt-1").setAttribute("width", realWidth)
					document.querySelector("#patt-1").setAttribute("height", realHeight)
 
					document.querySelector("#patt-1 image").setAttribute("width", realWidth)
					document.querySelector("#patt-1 image").setAttribute("height", realHeight)

					var newBgWidth = realWidth * scaler;
					var newBgHeight = realHeight * scaler;
					// console.log(newBgHeight)
					var translateX = (rectWidth - newBgWidth)/2;
					var translateY = (rectHeight - newBgHeight)/2;
					// console.log(rectHeight - newBgHeight)

					document.querySelector("#patt-1 image").setAttribute("transform", `scale(${scaler}) translate(${translateX}, ${translateY})`)


				}
				else if(baseScale != -1) // Tile
				{
					document.querySelector('#gridSlider').value = baseScale;

					var tileW = realWidth/baseScale, 
						tileH = realHeight/baseScale;

					document.querySelector("#patt-1").setAttribute("width", tileW)
					document.querySelector("#patt-1").setAttribute("height", tileH)

					document.querySelector("#patt-1").setAttribute("baseWidth", realWidth)
					document.querySelector("#patt-1").setAttribute("baseHeight", realHeight)
					document.querySelector("#patt-1").setAttribute("hSpacing", 0)
					document.querySelector("#patt-1").setAttribute("vSpacing", 0)


					document.querySelector("#patt-1 image").setAttribute("width", tileW)
					document.querySelector("#patt-1 image").setAttribute("height", tileH)



					// Spacing Sliders max values

					document.querySelector("#hSpacingSlider").setAttribute("maxSpacing", (rectWidth-tileW))
					document.querySelector("#vSpacingSlider").setAttribute("maxSpacing", (rectHeight-tileH))
					

				}

				
			};
		}
		
		initBg(0)

		function gridSliderOnChange()
		{
			var baseScale = document.querySelector('#gridSlider').value;
			
			baseScale = baseScale > 0 ? baseScale : 1;

			var baseWidth = parseFloat(document.querySelector("#patt-1").getAttribute("baseWidth"))
			var baseHeight= parseFloat(document.querySelector("#patt-1").getAttribute("baseHeight"))

			var hSpacing = parseFloat(document.querySelector("#patt-1").getAttribute("hSpacing"))
			var vSpacing = parseFloat(document.querySelector("#patt-1").getAttribute("vSpacing"))

			var tileW = baseWidth/baseScale, 
				tileH = baseHeight/baseScale;

			
			document.querySelector("#patt-1").setAttribute("width", (tileW + hSpacing))
			document.querySelector("#patt-1").setAttribute("height", (tileH + vSpacing))
 
			document.querySelector("#patt-1 image").setAttribute("width", tileW)
			document.querySelector("#patt-1 image").setAttribute("height", tileH)
			
		}

		function hSpacingSliderOnChange()
		{
			var ratio = document.querySelector('#hSpacingSlider').value;
			
			var maxSpacing = parseFloat(document.querySelector("#hSpacingSlider").getAttribute("maxSpacing"))

			var hSpacing = 0;
			if(ratio > 0)
				hSpacing = maxSpacing*(ratio/100);

			document.querySelector("#patt-1").setAttribute("hSpacing", hSpacing)
  

			gridSliderOnChange();
			
		}

		function vSpacingSliderOnChange()
		{
			var ratio = document.querySelector('#vSpacingSlider').value;
			
			var maxSpacing = parseFloat(document.querySelector("#vSpacingSlider").getAttribute("maxSpacing"))

			var vSpacing = 0;
			if(ratio > 0)
				vSpacing = maxSpacing*(ratio/100);

			document.querySelector("#patt-1").setAttribute("vSpacing", vSpacing)

			gridSliderOnChange();
			
		}
 
	</script>
	
</body> 

</html> 
